<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RedWanc Live Portfolio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    pre {
      background: #eee;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Live Portfolio Value</h1>
    <div id="portfolio-output">Loading portfolio data...</div>
  </div>

  <script>
    // Hard-coded portfolio holdings
    const portfolio = {
      stocks: {
        "GOOGL": 10.0046,   // Google
        "AAPL": 70.0801,    // Apple
        "CRWD": 10,         // CrowdStrike
        "FTNT": 60,         // Fortinet
        "MSFT": 20.0349,    // Microsoft
        "PANW": 40,         // Palo Alto Networks
        "VOO": 80.27,       // VOO ETF
        "VTI": 60.1988,     // VTI ETF
        "CASH": 120.81      // Cash (treated as $1 per unit)
      },
      crypto: {
        "crypto-com-chain": 4230.08,      // CRO
        "ethereum": 15.358,               // ETH
        "ondo-finance": 12777.8,          // ONDO (updated ID)
        "ripple": 1050.1,                 // XRP (CoinGecko ID: "ripple")
        "chainlink": 162.63,              // LINK
        "hedera-hashgraph": 11880.6,       // HBAR
        "render-network-token": 630.7,     // RENDER
        "bitcoin": 0.021652,              // BTC
        "solana": 11.067,                 // SOL
        "internet-computer": 194.5,       // ICP
        "stellar": 4021,                  // XLM
        "plume": 5150,                    // PLUME (verify if available)
        "shiba-inu": 70000000,            // SHIB
        "zro": 114.3,                     // ZRO (verify if available)
        "quant-network": 4.5,             // QNT
        "near": 94.9,                     // NEAR
        "tia": 73.9,                      // TIA (verify if available)
        "pyth-network": 1541.7,           // PYTH
        "optimism": 285,                  // OP
        "axl": 556.4,                     // AXL (verify if available)
        "polkadot": 53.1,                 // DOT
        "cardano": 329.4,                 // ADA
        "injective-protocol": 22.83,      // INJ
        "aave": 1.014,                    // AAVE
        "avalanche-2": 9.33,              // AVAX
        "mina-protocol": 657.1,           // MINA
        "w": 1451.9,                      // W (verify if available)
        "flux": 660.7,                    // FLUX
        "arweave": 23,                    // AR
        "immutable-x": 282.7,             // IMX
        "akash-network": 116.4,           // AKT (updated ID)
        "fetch-ai": 284.8,                // FET
        "beamx": 16873,                   // BEAMX (verify if available)
        "sui": 54,                        // SUI (if available)
        "peaq": 906.5,                    // PEAQ (verify if available)
        "ena": 267.4                      // ENA (verify if available)
      }
    };

    // Cache expiration time: 1 hour (in milliseconds)
    const CACHE_EXPIRATION = 3600000; 

    // Fetch stock prices from Financial Modeling Prep API with caching
    async function fetchStockPrices(tickers) {
      const filteredTickers = tickers.filter(ticker => ticker !== "CASH");
      const apiKey = "Fc9oyaB0wNnrCJfKqt6PWOzdKaYgruh5"; // Your API key
      const fmpUrl = "https://financialmodelingprep.com/api/v3/quote/" 
                     + filteredTickers.join(",") 
                     + "?apikey=" + apiKey;
      const cacheKey = "stockPricesCache";
      const cached = localStorage.getItem(cacheKey);
      if (cached) {
        const cachedData = JSON.parse(cached);
        if (Date.now() - cachedData.timestamp < CACHE_EXPIRATION) {
          console.log("Using cached stock prices");
          return cachedData.data;
        }
      }
      try {
        const response = await fetch(fmpUrl);
        const data = await response.json();
        const results = {};
        data.forEach(item => {
          results[item.symbol] = item.price;
        });
        localStorage.setItem(cacheKey, JSON.stringify({
          timestamp: Date.now(),
          data: results
        }));
        return results;
      } catch (error) {
        console.error("Error fetching stock prices:", error);
        return {};
      }
    }

    // Fetch crypto prices from CoinGecko with caching
    async function fetchCryptoPrices(cryptoIds) {
      const url = "https://api.coingecko.com/api/v3/simple/price?ids=" 
                  + cryptoIds.join(",") 
                  + "&vs_currencies=usd";
      const cacheKey = "cryptoPricesCache";
      const cached = localStorage.getItem(cacheKey);
      if (cached) {
        const cachedData = JSON.parse(cached);
        if (Date.now() - cachedData.timestamp < CACHE_EXPIRATION) {
          console.log("Using cached crypto prices");
          return cachedData.data;
        }
      }
      try {
        const response = await fetch(url);
        const data = await response.json();
        localStorage.setItem(cacheKey, JSON.stringify({
          timestamp: Date.now(),
          data: data
        }));
        return data;
      } catch (error) {
        console.error("Error fetching crypto prices:", error);
        return {};
      }
    }

    async function calculatePortfolioValue() {
      // Stocks
      const stockTickers = Object.keys(portfolio.stocks);
      const stockPrices = await fetchStockPrices(stockTickers);
      let totalValue = 0;
      let output = "<h2>Stocks</h2><pre>";
      for (const [ticker, amount] of Object.entries(portfolio.stocks)) {
        const price = (ticker === "CASH") ? 1 : (stockPrices[ticker] || 0);
        const value = price * amount;
        totalValue += value;
        output += `${ticker}: ${amount} x $${price.toFixed(2)} = $${value.toFixed(2)}\n`;
      }
      output += "</pre>";

      // Crypto
      const cryptoIds = Object.keys(portfolio.crypto);
      const cryptoPricesData = await fetchCryptoPrices(cryptoIds);
      output += "<h2>Crypto</h2><pre>";
      for (const [id, amount] of Object.entries(portfolio.crypto)) {
        const price = (cryptoPricesData[id] && cryptoPricesData[id].usd) || 0;
        const value = price * amount;
        totalValue += value;
        output += `${id}: ${amount} x $${price.toFixed(2)} = $${value.toFixed(2)}\n`;
      }
      output += "</pre>";

      output += `<h2>Total Portfolio Value: $${totalValue.toFixed(2)}</h2>`;
      document.getElementById("portfolio-output").innerHTML = output;
    }

    // Refresh data on page load and then every hour
    window.addEventListener("load", calculatePortfolioValue);
    setInterval(calculatePortfolioValue, CACHE_EXPIRATION);
  </script>
</body>
</html>
